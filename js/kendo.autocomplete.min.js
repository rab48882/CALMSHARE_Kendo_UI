/*
* Kendo UI v2011.3.1407 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at http://kendoui.com/license.
* If you do not own a commercial license, this file shall be governed by the
* GNU General Public License (GPL) version 3. For GPL requirements, please
* review: http://www.gnu.org/copyleft/gpl.html
*/

(function(a,b){function w(a){var b=a.value.length;r(a,b,b)}function v(a,b,c,d){var e=b.split(d);e.splice(t(a,b,d),1,c),d&&e[e.length-1]!==""&&e.push("");return e.join(d)}function u(a,b,c){return b.split(c)[t(a,b,c)]}function t(a,b,c){return c?b.substring(0,a).split(c).length-1:0}var c=window.kendo,d=c.support.touch,e=c.ui,f=c.keys,g=c.data.DataSource,h=e.List,i="change",j="k-state-default",k="disabled",l="k-state-focused",m="k-state-selected",n="k-state-disabled",o="k-state-hover",p="mouseenter mouseleave",q=h.caret,r=h.selectText,s=a.proxy,x=h.extend({init:function(b,d){var e=this;d=a.isArray(d)?{dataSource:d}:d,h.fn.init.call(e,b,d),b=e.element,e._wrapper(),e._accessors(),e.dataSource=g.create(e.options.dataSource).bind(i,s(e.refresh,e)),e.bind([i],e.options),b[0].type="text",b.attr("autocomplete","off").addClass("k-input").bind({keydown:s(e._keydown,e),paste:s(e._search,e),focus:function(){e._old=e.value(),e.wrapper.addClass(l)},blur:function(){e._bluring=setTimeout(function(){c.support.touch?e._change():e._blur(),e.wrapper.removeClass(l)},100)}}),e._enable(),e._popup()},options:{name:"AutoComplete",suggest:!1,minLength:1,delay:200,height:200,filter:"startswith"},enable:function(a){var b=this,c=b.element,d=b.wrapper;a===!1?(d.removeClass(j).addClass(n).unbind(p),c.attr(k,k)):(d.removeClass(n).addClass(j).bind(p,b._toggleHover),c.removeAttr(k))},close:function(){var a=this;a._current=null,a.popup.close()},refresh:function(){var b=this,d=b.ul[0],e=b.options,f=e.suggest,g=b.dataSource.view(),h=g.length;d.innerHTML=c.render(b.template,g),b._height(h),h&&((f||e.highlightFirst)&&b.current(a(d.firstChild)),f&&b.suggest(b._current)),b._open&&(b._open=!1,b.popup[h?"open":"close"]())},select:function(b){var c=this,d=c.options.separator,e=c.dataSource.view(),f,g;b=a(b),b[0]&&!b.hasClass(m)&&(g=h.inArray(b[0],c.ul[0]),g>-1&&(e=e[g],f=c._text(e),d&&(f=v(q(c.element[0]),c.value(),f,d)),c.value(f),c.current(b.addClass(m))))},search:function(a){var b=this,a=a||b.value(),c=b.options,d=c.separator,e,f,g;b._current=null,clearTimeout(b._typing),d&&(a=u(q(b.element[0]),a,d)),e=a.length,e?e>=b.options.minLength&&(b._open=!0,b.dataSource.filter({field:c.dataTextField,operator:c.filter,value:a})):b.popup.close()},suggest:function(a){var c=this,d=c._last,e=c.value(),g=c.element[0],h=q(g),i=c.options.separator,j=e.split(i),k=t(h,e,i),l=h,m;d==f.BACKSPACE||d==f.DELETE?c._last=b:(a=a||"",typeof a!="string"&&(m=a.index(),m>-1?a=c._text(c.dataSource.view()[m]):a=""),h<=0&&(h=e.toLowerCase().indexOf(a.toLowerCase())+1),m=e.substring(0,h).lastIndexOf(i),m=m>-1?h-(m+i.length):h,e=j[k].substring(0,m),a&&(m=a.toLowerCase().indexOf(e.toLowerCase()),m>-1&&(a=a.substring(m+e.length),l=h+a.length,e+=a),i&&j[j.length-1]!==""&&j.push("")),j[k]=e,c.value(j.join(i||"")),r(g,h,l))},value:function(a){var c=this,d=c.element[0];if(a!==b)d.value=a;else return d.value},_accept:function(a){var b=this;c.support.touch?setTimeout(function(){b._focus(a)},0):b._focus(a),w(b.element[0])},_keydown:function(b){var c=this,d=c.ul[0],e=b.keyCode,g=c._current,h=c.popup.visible();c._last=e,e===f.DOWN?(h&&c._move(g?g.next():a(d.firstChild)),b.preventDefault()):e===f.UP?(h&&c._move(g?g.prev():a(d.lastChild)),b.preventDefault()):e===f.ENTER||e===f.TAB?(c.popup.visible()&&b.preventDefault(),c._accept(g)):e===f.ESC?c.close():c._search()},_move:function(a){var b=this;a=a[0]?a:null,b.current(a),b.options.suggest&&b.suggest(a)},_search:function(){var a=this;clearTimeout(a._typing),a._typing=setTimeout(function(){a._old!==a.value()&&(a._old=a.value(),a.search())},a.options.delay)},_toggleHover:function(b){d||a(b.currentTarget).toggleClass(o,b.type==="mouseenter")},_wrapper:function(){var a=this,b=a.element,c=b[0],d="tabIndex",e;e=b.parent(),e.is("span.k-widget")||(e=b.wrap("<span />").parent()),e[0].style.cssText=c.style.cssText,b.css({width:"100%",height:"auto"}),a._focused=a.element,a.wrapper=e.addClass("k-widget k-autocomplete k-header").addClass(c.className)}});e.plugin(x)})(jQuery)